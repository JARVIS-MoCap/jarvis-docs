---
title: Trigger
author: Timo Hueser
date: 2021-10-29
layout: post
---

```plantuml!
!theme sandstone
"Recording PC" -> MCU: setup (Frames)
"Recording PC" <-- MCU: ack
"Recording PC" <-- MCU: Inputs
"Recording PC" -> MCU: ack
```

```plantuml!
!theme sandstone
"Recording PC" <-- MCU: Inputs
"Recording PC" -> MCU: ack
```

Waring: ACKs are not yet handled by the MCU

## Message encoding

```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Bytes" as A
concise "Packet Structure" as B

@0
A is "COBS encoded"
B is header
@3
B is payload
@12
A is "Packet delimiter"
B is {hidden}
@13
A is {hidden}

```

## Input Message

+ TYPE_INPUTS

```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is payload
B is inputs
@4
B is uptime_us
@8
B is pulse_id
@12
A is {hidden}
B is {hidden}
@13
A is {hidden}
B is {hidden}

```

## Setup Message

+ TYPE_SETUP


```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is payload
B is pulse_hz
@4
B is pulse_limit
@8
B is delay_us
@12
B is flags
@13
A is {hidden}
B is {hidden}
```

 | Bit | Flag          | Description                                                                   |
 | --- | ------------- | ----------------------------------------------------------------------------- |
 | 0   | RESET_COUNTER | If set to true (1) the setup command will reset the current Framecounter to 0 |
 | 1-7 | RESERVED      | Reserved flag for later functionality                                         |


## Type-Only Messages

+ TYPE_ACK

 ```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is {hidden}
B is {hidden}
@13
A is {hidden}
B is {hidden}
```

## Char Messages

+ TYPE_ECHO
+ TYPE_TXT
+ TYPE_ERROR

 ```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is payload
B is "char[]"
@13

```


