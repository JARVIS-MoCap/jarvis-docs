---
title: Trigger
author: 
date: 2021-10-29
layout: post
---



## Installation using PlatformIO

### PlatformIO

PlatformIO is an software ecosystem that greatly simplifies the programming of microcontrollers. It is available as a plugin for many programming environments and can also be run directly from the command line.

#### Installing PlatformIO

We recommend using one of the options below to flash your microcontroller:

##### Visual Studio Code (VSCode).

Installation Guide:
See: https://platformio.org/platformio-ide

After PlatformIO is successfully installed, clone the trigger firmware from Github using git:

Use "Clone Git Repository" in VS Code and type:
`https://github.com/JARVIS-MoCap/JARVIS-TriggerFirmware.git`
in the window that opens.

![Code_1_arrow](docs/assets/trigger_doc/Code_1_arrow.png)

![Code_2](docs/assets/trigger_doc/Code_2.png)

After that, open the folder manually or press open folder when VS Code asks you for the Git repository you just cloned:

![Code_3](docs/assets/trigger_doc/Code_3.png).

If PlatformIO is installed correctly, all the required dependencies should be installed automatically.

After the project is set up correctly, open the PlatformIO tab on the left side of the page 

![Code_4](docs/assets/trigger_doc/Code_4.png)

If your microcontroller is officially supported, connect your microcontroller to your machine, open the context menu of the microcontroller you want to flash and press "Upload".

##### CLI

Installation Guide:
See: https://platformio.org/install/cli

Make sure you can run the commands in your terminal:

```bash
platformio run --help
```

#### Flashing a microcontroller

If your microcontroller is supported, you can find a corresponding environment in `JARVIS-TriggerFirmware/platformio.ini`.

To flash your microcontroller, execute:

```bash
platformio run -t upload -e <YOUR_MCU_ENVIRONMENT>
```

Translated with www.DeepL.com/Translator (free version)

## Wireing Guide
The default behavior for all microcontrollers with enough pins is that pins 0-15 are available as trigger outputs for your cameras and pins 16-23 are pullup enabled input pins for the timed logging feature of the Acquisition software. If your microcontroller does not have the required number of pins, or does not have support for functionality such as digital interrupt on all input pins, you should look at the respective header files in the ```boards/``` folder.
## Trigger protocoll

<!-- ```plantuml!
!theme sandstone
"Recording PC" -> MCU: setup (Frames)
"Recording PC" <-- MCU: ack
"Recording PC" <-- MCU: Inputs
"Recording PC" -> MCU: ack
``` -->

![A](docs/assets/plantuml/SoWkIImgAStDuL8ioKZDJLKeJinBAIx9pqlbKWfAJSulIidCIrS8S5PIqBLJy7KEjL8eJYqfBL3GS2jAp4qjraHNPQEh2r6Mc9oDKyuphw2qf1ZJ0eHEXzIy5A2Z0000.svg)

<!-- ```plantuml!
!theme sandstone
"Recording PC" <-- MCU: Inputs
"Recording PC" -> MCU: ack
``` -->

![A](docs/assets/plantuml/SoWkIImgAStDuL8ioKZDJLKeJinBAIx9pqlbKWfAJSulIidCIrS8S5PIiD7LLV1r3hLIyCmhA2qfHfVMjOF89YPdSpcavgK0ZGG0.svg)

Waring: ACKs are not yet handled by the MCU

### Message encoding

<!-- ```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Bytes" as A
concise "Packet Structure" as B

@0
A is "COBS encoded"
B is header
@3
B is payload
@12
A is "Packet delimiter"
B is {hidden}
@13
A is {hidden}
``` -->


![A](docs/assets/plantuml/HOzHQWCn34J_TGhL9qWQ-k-u1sWX9n3Mm9fwxM1feQ7qxirs5_PJR-O99fhBy6MkzE8JPh19K_FUG9QbWiyincydlfTlLAFSMou63kdXiB26rmD-Ilw2yyt7adqP-CyJKJpHbOjnUFz8DqRBNQ61qiecY69Gl6pdNHwrYr8yl-xE_bHHormSO_T-fgAAzljiNhRcGT3qEUaF.svg)

### Input Message

+ TYPE_INPUTS

<!-- ```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is payload
B is inputs
@4
B is uptime_us
@8
B is pulse_id
@12
A is {hidden}
B is {hidden}
@13
A is {hidden}
B is {hidden}
``` -->

![A](docs/assets/plantuml/VOj1IWGn44NtTOfoJZ0ze-2ofayWU80X91yxc4w7L0LinBjBMw0xT_N-goTgeTjO2ptOWXMieIQrhO8qXWAUE2W_dRdb3nIbkDMO5Nnw2V4Tng_MHxJHSJh-Rdz-tWtwCyv4SgORP-K58Q7JVDosDv1C3WNrpHQIYsFiaUJgJGjxsK9oaMiRfYIFZgDPNd4VIlBiInj5SS-9PBfu_xdab52_tF-IJDV_FMeQQ_a6.svg)

### Setup Message

+ TYPE_SETUP

<!-- ```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is payload
B is pulse_hz
@4
B is pulse_limit
@8
B is delay_us
@12
B is flags
@13
A is {hidden}
B is {hidden}
``` -->

![A](docs/assets/plantuml/JOnDJWCn34RtFeNf2Lf-99PfJu340Ieh-MWYF9bHx4WCYBl3a0hOvNqlVi5SclT9wSOp9h19JUPp1LaK1HzOZ1_sl9Gtg56SQom6tZr9V8NpixSUlJVijd_7FtzQ7VOpdeZ2devSZ3CaeT5fU_kwWC9XWA9UF5Eu7HXRf70tRXPPTPOqnDBLSCxl5Ex_3rgcuXGUnvQWifwxVTUllHULouRNv4SkAQ5-3lbB0JNrIRy0.svg)


 | Bit | Flag          | Description                                                                   |
 | --- | ------------- | ----------------------------------------------------------------------------- |
 | 0   | RESET_COUNTER | If set to true (1) the setup command will reset the current Framecounter to 0 |
 | 1-7 | RESERVED      | Reserved flag for later functionality                                         |

### Type-Only Messages

+ TYPE_ACK

<!-- ```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is {hidden}
B is {hidden}
@13
A is {hidden}
B is {hidden}
``` -->

![A](docs/assets/plantuml/XOj12i8m54Jt_nJVdg1LtASzWU09GZAOO9gM_1-mY7UN6j2bktdpPeoeBLhdH0SDcC5YinTTCaYSJU21hV2vvpK-a8JSabqKS7UnxWxbgvRgj1Pq-sxy-MbJoAUSY4nF8qVX0EjHQDgpRYl830qIyaq3cMD3LnoPK_iyG_GU-TNCbypmnoFxEgSt.svg)


### Char Messages

+ TYPE_ECHO
+ TYPE_TXT
+ TYPE_ERROR

<!-- ```plantuml!
!theme sandstone
scale 1 as 50 pixels
concise "Packet Structure" as A
concise "Bytes" as B

@0
A is header
B is type
@1
B is length
@2
B is crc
@3
A is payload
B is "char[]"
@13

``` -->

![A](docs/assets/plantuml/HOin3i8m34LtdyBa12qLUzeJ834Y1iknI4MQLh4ZqTj3oS3cv_UVLwDYTKbmiYYBe58EQciMKAOas2CfNZhSvhSa1LuppohehiGlCRnPgMorY3jsuzzFkud-dXE0xs34MJ4A1Iam7RVjcu3l6oJ9JulWpmsvCFYXDHljQQNGXED8vVvmtt00BpdK9Nq0.svg)
